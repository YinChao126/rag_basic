# RAG åŸºç¡€æ¦‚å¿µï¼šè®©å¤§æ¨¡å‹â€œè®°å¾—ä½â€çš„ç§˜å¯†

## ä¸€ã€RAG æ˜¯ä»€ä¹ˆï¼Ÿ

RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ˜¯ä¸€ç§**è®©å¤§è¯­è¨€æ¨¡å‹â€œæŸ¥èµ„æ–™åå†å›ç­”â€çš„æŠ€æœ¯æ–¹æ¡ˆ**ã€‚

ä¼ ç»Ÿå¤§æ¨¡å‹å›ç­”é—®é¢˜ï¼Œåªä¾èµ–æ¨¡å‹è‡ªèº«è®­ç»ƒæ—¶å­¦åˆ°çš„çŸ¥è¯†ï¼Œä½†è¿™äº›çŸ¥è¯†æ˜¯**é™æ€çš„**ï¼Œ**æ— æ³•å®æ—¶æ›´æ–°**ã€‚ RAG åˆ™é€šè¿‡ä¸€ä¸ªç®€å•çš„æ€è·¯è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š

> **åœ¨ç”Ÿæˆå›ç­”å‰ï¼Œå…ˆå»çŸ¥è¯†åº“é‡Œæ£€ç´¢ç›¸å…³å†…å®¹ï¼Œå†è®©æ¨¡å‹å‚è€ƒè¿™äº›å†…å®¹è¿›è¡Œå›ç­”ã€‚**

è¿™å°±æ˜¯ â€œRetrieval + Generationâ€ â€”â€” æ£€ç´¢å¢å¼ºç”Ÿæˆã€‚



------



## äºŒã€ä¸ºä»€ä¹ˆéœ€è¦ RAGï¼Ÿ

åŸå› å¾ˆç®€å•ï¼š**å¤§æ¨¡å‹ä¸å¯èƒ½çŸ¥é“ä¸€åˆ‡ã€‚**

å› ä¸ºå¤§æ¨¡å‹æ˜¯å…¬æœ‰æ•°æ®é›†è®­ç»ƒå‡ºæ¥çš„ï¼Œä»–ä¸çŸ¥é“â€œä½ å®¶çš„ç‹—å«æ—ºè´¢â€ï¼Œâ€œæ‘é‡Œæœ‰ä¸ªå§‘å¨˜å«å°èŠ³â€ã€æš´éœ²äº†å¹´çºªã€‘è¿™ç§ç§æœ‰ä¿¡æ¯ã€‚

| åœºæ™¯                         | ä¼ ç»Ÿ LLM                      | ä½¿ç”¨ RAG å                          |
| ---------------------------- | ----------------------------- | ------------------------------------ |
| å…¬å¸å†…éƒ¨æ–‡æ¡£é—®ç­”             | æ¨¡å‹ä¸äº†è§£ä¼ä¸šå†…éƒ¨å†…å®¹        | æ¨¡å‹å…ˆä»ä¼ä¸šçŸ¥è¯†åº“æ£€ç´¢ç›¸å…³æ–‡æ¡£å†å›ç­” |
| æ³•å¾‹ã€åŒ»ç–—ç­‰ä¸“ä¸šé¢†åŸŸ         | å®¹æ˜“èƒ¡è¯´å…«é“ï¼ˆhallucinationï¼‰ | æ¨¡å‹åŸºäºæƒå¨èµ„æ–™å›ç­”ï¼Œç»“æœæ›´å¯é      |
| å®æ—¶æ•°æ®ï¼ˆæ–°é—»ã€ä»£ç ã€è®ºæ–‡ï¼‰ | æ¨¡å‹çŸ¥è¯†æ»å                  | æ£€ç´¢åˆ°æœ€æ–°èµ„æ–™ï¼Œå®æ—¶è¡¥å……çŸ¥è¯†         |

ä¸€å¥è¯ï¼š

> **RAGè®©LLMæ‹¥æœ‰â€œå¤–è„‘â€ã€‚**



------



## ä¸‰ã€è°åœ¨ç”¨ RAGï¼Ÿ

å‡ ä¹æ‰€æœ‰ä¸¥è°¨çš„ LLM åº”ç”¨éƒ½åœ¨ç”¨å®ƒã€‚ åŒ…æ‹¬ï¼š

- ä¼ä¸šæ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼ˆå¦‚ä¼ä¸šæ–‡æ¡£é—®ç­”ã€å®¢æœåŠ©æ‰‹ï¼‰
- æ•™è‚²/ç§‘ç ”æœç´¢åŠ©æ‰‹ï¼ˆå¦‚è®ºæ–‡é—®ç­”ï¼‰
- ç¼–ç¨‹åŠ©æ‰‹ï¼ˆä»£ç æœç´¢ + é—®ç­”ï¼‰
- åŒ»ç–—ã€æ³•å¾‹ã€é‡‘èé¢†åŸŸçŸ¥è¯†é—®ç­”ç³»ç»Ÿ

å¸¸è§çš„æ¡†æ¶ï¼š

-  **LangChain**ï¼šæœ€é€šç”¨çš„RAGåº”ç”¨æ¡†æ¶
-  **RagFlowã€LangGraphï¼š**ä½ä»£ç é«˜é›†æˆåº¦æ¡†æ¶
-  **LlamaIndex**ï¼šæ–‡æ¡£æ£€ç´¢é€»è¾‘æ›´å¼º
-  **Haystack**ï¼šé«˜æ€§èƒ½å·¥ä¸šçº§æ–¹æ¡ˆ
-  **Mem0 / LanceDB / Chroma**ï¼šç”¨ä½œRAGçš„å¤–éƒ¨è®°å¿†å±‚ï¼ˆå‘é‡æ•°æ®åº“ï¼‰

> æœ¬å·¥ç¨‹é‡‡ç”¨LangChainè®²è§£ï¼Œä¸»è¦æ˜¯è‡ªä¸»å¯æ§ï¼Œå¸®åŠ©ç†è§£åº•å±‚åŸç†ï¼Œå®é™…ç”Ÿäº§æ—¶å¤§å¤šç”¨æ›´é«˜é›†æˆåº¦çš„æ¡†æ¶



------



## å››ã€RAGå…·ä½“æ€ä¹ˆå®ç°çš„ï¼Ÿ

RAG çš„æ ¸å¿ƒæµç¨‹æ¯”è¾ƒç®€å•ï¼š

| æ­¥éª¤ | åç§°                        | è¯´æ˜                                                  |
| ---- | --------------------------- | ----------------------------------------------------- |
| â‘     | **æ–‡æ¡£åˆ‡ç‰‡ï¼ˆsplit/chunkï¼‰** | æŠŠåŸå§‹æ–‡æ¡£åˆ‡æˆå°å—ï¼ˆchunkï¼‰ï¼Œæ–¹ä¾¿åç»­æ£€ç´¢ã€‚           |
| â‘¡    | **å‘é‡åŒ–ï¼ˆembeddingï¼‰**     | æŠŠæ¯ä¸ªchunkè½¬æˆå‘é‡ï¼ˆæ•°å­—å½¢å¼ï¼‰ï¼Œè®©è®¡ç®—æœºèƒ½ç†è§£è¯­ä¹‰ã€‚ |
| â‘¢    | **å­˜å‚¨ï¼ˆvector storeï¼‰**    | æŠŠæ‰€æœ‰å‘é‡ä¿å­˜åˆ°å‘é‡æ•°æ®åº“ï¼ˆå¦‚ Chromaï¼‰ã€‚             |
| â‘£    | **æ£€ç´¢ï¼ˆretrievalï¼‰**       | ç”¨æˆ·æé—®æ—¶ï¼ŒæŠŠé—®é¢˜ä¹Ÿè½¬æˆå‘é‡ï¼Œå»æ‰¾æœ€ç›¸ä¼¼çš„æ–‡æ¡£ã€‚      |
| â‘¤    | **ç”Ÿæˆï¼ˆgenerationï¼‰**      | æŠŠæ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹äº¤ç»™LLMï¼Œè®©å®ƒå‚è€ƒåå›ç­”é—®é¢˜ã€‚       |

è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™5ä¸ªæ ¸å¿ƒæ­¥éª¤æ‹†åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„è¿‡ç¨‹ï¼Œç”¨â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å‹è¿›è¡Œè§£é‡Šï¼š

**çŸ¥è¯†ç”Ÿäº§ï¼š**åŸæ–‡æ¡£ -> åˆ‡ç‰‡ -> å‘é‡åŒ– -> çŸ¥è¯†åº“å­˜å‚¨

**çŸ¥è¯†æ¶ˆè´¹ï¼š**æ ¹æ®æé—®æ£€ç´¢ç›¸å…³çŸ¥è¯†åº“ -> ç»¼åˆå¬å›ç­–ç•¥ç”Ÿäº§prompt -> åˆ©ç”¨LLMç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ



ğŸ“˜ ä¸€å¥è¯æ€»ç»“ï¼š

> **RAG = æ–‡æ¡£åˆ‡ç‰‡ + å‘é‡åŒ– + æ£€ç´¢ + ç”Ÿæˆ**



------



## äº”ã€å…³é”®æ¦‚å¿µæ‰«ç›²

è¯¦ç»†å¯å‚è€ƒã€Šæœ¯è¯­è¡¨ã€‹

| æ¦‚å¿µ              | è§£é‡Š                                                     | ä¸¾ä¾‹                                  |
| ----------------- | -------------------------------------------------------- | ------------------------------------- |
| **split / chunk** | æ–‡æœ¬åˆ‡ç‰‡ï¼ŒæŠŠå¤§æ–‡æ¡£åˆ‡æˆå°å—ï¼ˆå¦‚æ¯500å­—ä¸€å—ï¼‰              | â€œRAGåŸºç¡€æ¦‚å¿µâ€ â†’ åˆ†æˆè‹¥å¹²å°æ®µ          |
| **embedding**     | å‘é‡åŒ–ï¼ŒæŠŠæ–‡å­—å˜æˆæ•°å­—å‘é‡                               | â€œè‹¹æœâ€â†’ [0.12, -0.45, 0.78, â€¦]        |
| **chromadb**      | å‘é‡æ•°æ®åº“ï¼Œç”¨æ¥å­˜å‚¨å’Œæ£€ç´¢è¿™äº›å‘é‡                       | Chromaã€FAISSã€Milvus                 |
| **retriever**     | æ£€ç´¢å™¨ï¼Œè´Ÿè´£æ ¹æ®ç”¨æˆ·æé—®æ‰¾åˆ°æœ€ç›¸ä¼¼çš„chunks               | ç”¨æˆ·é—®â€œä»€ä¹ˆæ˜¯RAGâ€ â†’ æ‰¾åˆ°è§£é‡ŠRAGçš„æ®µè½ |
| **rerank**        | é‡æ’åºï¼Œè®©æ£€ç´¢ç»“æœæ›´ç›¸å…³                                 | ç”¨CrossEncoderæˆ–Embeddingå†æ‰“åˆ†æ’åº   |
| **hybrid search** | æ··åˆæ£€ç´¢ï¼Œç»“åˆâ€œå…³é”®è¯åŒ¹é…ï¼ˆBM25ï¼‰+è¯­ä¹‰æ£€ç´¢ï¼ˆEmbeddingï¼‰â€ | æå‡æ£€ç´¢å‡†ç¡®ç‡                        |
| **mem0 / memory** | é•¿æœŸè®°å¿†ï¼Œç”¨äºç®¡ç†å¤šè½®ä¼šè¯ä¸­çš„çŸ¥è¯†ä¸Šä¸‹æ–‡                 | â€œå¯¹è¯è®°å¿†â€ç³»ç»Ÿ                        |

æ³¨ï¼šç»™å‡ºçš„æ¦‚å¿µéƒ½æ˜¯è‡³å…³é‡è¦çš„ï¼Œæœ¬æ–‡ä»…ç»™å‡ºç®€å•è§£é‡Šï¼Œå¦‚éœ€æ·±å…¥ç†è§£ï¼Œå¯ä»¥è‡ªè¡ŒGoogleï¼Œä¸å†èµ˜è¿°ã€‚



------



## å…­ã€RAGç”Ÿæ€åœ°å›¾

| åŠŸèƒ½              | å¸¸ç”¨å·¥å…·                                                 |
| ----------------- | -------------------------------------------------------- |
| æ–‡æœ¬åŠ è½½          | `PyMuPDFLoader`, `DirectoryLoader`                       |
| æ–‡æœ¬åˆ‡ç‰‡          | `RecursiveCharacterTextSplitter`                         |
| å‘é‡åŒ–            | `OllamaEmbeddings`, `OpenAIEmbeddings`, `QwenEmbeddings` |
| å‘é‡å­˜å‚¨          | `Chroma`, `FAISS`, `LanceDB`                             |
| æ£€ç´¢ä¸ç”Ÿæˆ        | `LangChain`, `LlamaIndex`, `Haystack`                    |
| é‡æ’åº / æ··åˆæ£€ç´¢ | `BM25Retriever`, `ColBERT`, `HybridRetriever`            |

------



## ä¸ƒã€RAGçš„æœ¬è´¨

> **RAG æ˜¯æŠŠâ€œæœç´¢å¼•æ“â€å’Œâ€œå¤§æ¨¡å‹â€ç»“åˆèµ·æ¥çš„ä¸€ç§çŸ¥è¯†å¢å¼ºæ–¹æ¡ˆã€‚**

RAGä»ç„¶è¿˜æ˜¯è°ƒç”¨LLMè¿›è¡Œå›ç­”ï¼ŒRAGç›¸æ¯”äºçº¯LLMæé—®é¢å¤–**åªå¤šäº†ä¸€ä¸ªæ­¥éª¤ï¼šæ”¹å†™ç”¨æˆ·çš„åŸå§‹prompt**ã€‚

promptå†…å®¹æ›´ä¸°å¯Œï¼Œè€Œä¸”æä¾›äº†æœ¬åœ°ç›¸å…³çŸ¥è¯†ï¼Œè¿™æ ·LLMæ‰èƒ½å¤Ÿç»“åˆå¤§æ¨¡å‹å’Œæœ¬åœ°çŸ¥è¯†ç»™å‡ºæ›´å‡†ç¡®çš„å›ç­”ã€‚

æœ‰æœ¬åœ°çŸ¥è¯†åº“çš„åŠ å…¥ï¼ŒLLM ä¸å†æ˜¯å­¤ç«‹çš„â€œå›ç­”å™¨â€ï¼Œè€Œæ˜¯ä¸€ä¸ªâ€œæ£€ç´¢-ç†è§£-ç”Ÿæˆâ€çš„é—­ç¯ç³»ç»Ÿã€‚

 åªè¦ä½ æŒæ¡ï¼š**æ–‡æ¡£åˆ‡ç‰‡ã€å‘é‡åŒ–ã€å‘é‡å­˜å‚¨ã€æ£€ç´¢ + ç”Ÿæˆ**ï¼Œ å°±å·²ç»ç†è§£äº† RAG çš„å…¨éƒ¨åº•å±‚é€»è¾‘ã€‚



------



## ä¸‹ä¸€ç¯‡é¢„å‘Šï¼šRAGæ ¸å¿ƒæµç¨‹æ‹†è§£

ä¸‹ä¸€ç¯‡ã€ŠRAGæ ¸å¿ƒæµç¨‹ã€‹å°†ä»å®æ“è§’åº¦å‡ºå‘ï¼Œä¸€æ­¥æ­¥å®Œæˆï¼š

> æ–‡æ¡£åŠ è½½ â†’ åˆ‡ç‰‡ â†’ å‘é‡åŒ– â†’ å­˜å‚¨ â†’ æ£€ç´¢ â†’ é—®ç­”
> ç”¨æœ€ç®€æ´çš„Pythonè„šæœ¬è·‘é€šRAGç³»ç»Ÿã€‚
>
> 

---



## å…«ã€å‚è€ƒæ–‡çŒ®

### æ ¸å¿ƒè®ºæ–‡

1. **Lewis, P., et al. (2020).** "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks." *Advances in Neural Information Processing Systems*, 33. [arXiv:2005.11401](https://arxiv.org/abs/2005.11401) - RAGåŸå§‹è®ºæ–‡

2. **Khattab, O., & Zaharia, M. (2020).** "ColBERT: Efficient and Effective Passage Search via Contextualized Late Interaction over BERT." *Proceedings of the 43rd International ACM SIGIR Conference*. [arXiv:2004.12832](https://arxiv.org/abs/2004.12832)

3. **Karpukhin, V., et al. (2020).** "Dense Passage Retrieval for Open-Domain Question Answering." *Proceedings of the 2020 Conference on Empirical Methods in Natural Language Processing*. [arXiv:2004.04906](https://arxiv.org/abs/2004.04906)

### æ¡†æ¶æ–‡æ¡£

- [LangChain Documentation](https://python.langchain.com/) - æœ€å…¨é¢çš„RAGåº”ç”¨æ¡†æ¶
- [LlamaIndex Documentation](https://docs.llamaindex.ai/) - ä¸“æ³¨äºæ•°æ®ç´¢å¼•å’Œæ£€ç´¢
- [Haystack Documentation](https://docs.haystack.deepset.ai/) - ä¼ä¸šçº§RAGè§£å†³æ–¹æ¡ˆ
- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/) - Agentå¼RAGåº”ç”¨

### å‘é‡æ•°æ®åº“

- [Chroma Documentation](https://docs.trychroma.com/) - è½»é‡çº§å‘é‡æ•°æ®åº“
- [FAISS Documentation](https://github.com/facebookresearch/faiss) - Facebookå¼€æºå‘é‡æ£€ç´¢åº“
- [Milvus Documentation](https://milvus.io/docs) - ç”Ÿäº§çº§å‘é‡æ•°æ®åº“

### å­¦ä¹ èµ„æº

- [The Illustrated Transformer](https://jalammar.github.io/illustrated-transformer/) - Transformeræ¶æ„å¯è§†åŒ–
- [RAG Tutorial by LangChain](https://python.langchain.com/docs/use_cases/question_answering/) - LangChain RAGæ•™ç¨‹